<div class="container mt-5">
    <h2 class="text-center mb-4">Image & Video Gallery</h2>
    <div class="row masonry-grid">
        <% media.forEach(item => { %>
            <div class="col-md-4 masonry-item mb-4">
                <div class="card">
                    <% if(item.type === 'image') { %>
                        <!-- Images are displayed directly within the card -->
                        <img src="<%= item.path %>" class="card-img-top" alt="<%= item.title %>" loading="lazy">
                    <% } else if(item.type === 'video') { %>
                        <!-- Videos are displayed directly within the card -->
                        <video controls class="card-img-top" preload="metadata">
                            <source src="<%= item.path %>" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    <% } %>
                </div>
            </div>
        <% }) %>
    </div>
</div>

<!-- Include Masonry and initialize it -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/imagesloaded/4.1.4/imagesloaded.pkgd.min.js"></script>
<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const grid = document.querySelector('.masonry-grid');
        const msnry = new Masonry(grid, {
            itemSelector: '.masonry-item',
            columnWidth: '.masonry-item',
            percentPosition: true
        });

        // Use imagesLoaded library if necessary to ensure that layout only happens after images are loaded
        imagesLoaded(grid, function() {
            msnry.layout();
        });
    });
</script>
